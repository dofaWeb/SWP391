@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = "_AdminLayout";
}

<style>
    .container {
        display: flex;
        margin-top: 20px;
    }

    .left-side,
    .right-side {
        padding: 20px;
    }

    .left-side {
        width: 30%;
        border-right: 1px solid #ddd;
    }

    .right-side {
        width: 70%;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-inline .form-control {
        width: auto;
    }

    .action-btns {
        display: flex;
        gap: 10px;
    }

    .table td,
    .table th {
        vertical-align: middle;
    }

    label {
        font-weight: bold;
    }

    /* Initially hide the Add and Edit Panels */
    #addPanel, #editPanel {
        display: none;
        border: 1px solid #ddd;
        padding: 20px;
        background-color: #f9f9f9;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 400px;
        z-index: 10;
    }

    /* Close button styling */
    .close-btn {
        float: right;
        cursor: pointer;
        font-size: 20px;
    }
</style>

<!-- Page Header -->
<header class="bg-dark text-white text-center py-4">
    <h1>Edit Product</h1>
</header>

<!-- Main Container -->
<div class="container">
    <!-- Left Side: Product Attributes -->
    <div class="left-side">
        <h3>Product Information</h3>
        <img src="~/pictures/@ViewBag.Product.Picture" />
        <form id="productForm" asp-controller="ProMan" asp-action="EditProduct" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="productID">Product ID:</label>
                <input type="text" name="Id" class="form-control" id="productID" value="@ViewBag.Product.Id" readonly>
            </div>
            <div class="form-group">
                <label for="productName">Product Name:</label>
                <input type="text" name="Name" class="form-control" id="productName" value="@ViewBag.Product.Name">
            </div>
            <!-- Category Selection -->
            <div class="form-group">
                <label for="category">Category:</label>
                <select class="form-control" id="category" required onchange="updateSubcategory()">
                    @if (ViewBag.Product.CategoryId.StartsWith("B0"))
                    {
                        <option value="laptop" selected>Laptop</option>
                        <option value="phone">Smartphone</option>
                    }
                    else
                    {
                        <option value="laptop">Laptop</option>
                        <option value="phone" selected>Smartphone</option>

                    }
                </select>
            </div>

            <!-- Subcategory Selection -->
            <div class="form-group">
                <label for="subcategory">Subcategory:</label>
                <select class="form-control" name="CategoryId" id="subcategory" required>
                    <!-- Subcategories will be updated based on the category selection -->
                    @if (ViewBag.Product.CategoryId.StartsWith("B0"))
                    {
                        @foreach (var item in ViewBag.Laptops)
                        {
                            @if (ViewBag.Product.CategoryId == item.Id)
                            {
                                <option value="@item.Id" selected>@item.Name</option>
                            }
                            else
                            {
                                <option value="@item.Id">@item.Name</option>
                            }
                        }
                    }else{
                        @foreach (var item in ViewBag.Smartphones)
                        {
                            @if (ViewBag.Product.CategoryId == item.Id)
                            {
                                <option value="@item.Id" selected>@item.Name</option>
                            }
                            else
                            {
                                <option value="@item.Id">@item.Name</option>
                            }
                        }
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="state">Product State:</label>
                <select class="form-control" name="StateId" id="state">
                    @foreach (var item in ViewBag.ProductState)
                    {
                        if (item.Id != 3)
                        {
                            if (item.Name == ViewBag.Product.ProductState)
                            {
                                <option value="@item.Id" selected>@item.Name</option>
                            }
                            else
                            {
                                <option value="@item.Id">@item.Name</option>
                            }
                        }
                    }
                </select>
            </div>
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea class="form-control" name="Description" id="description"
                          rows="4">@ViewBag.Product.Description.</textarea>
            </div>

            <!-- Product Image -->
            <div class="form-group">
                <label for="productImage">Product Image:</label>
                <input type="file" name="pictureUpload" class="form-control-file" id="productImage" accept="image/*">
            </div>
            <a asp-controller="ProMan" asp-action="Display" class="btn btn-danger">Cancel</a>
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </form>
    </div>

    <!-- Right Side: Storage, RAM, Quantity, Price Input and Add Button -->
    <div class="right-side">
        <h3>Product Items</h3>

        <!-- Add Button -->
        <button class="btn btn-success" id="addVariationBtn">Add Variation</button>

        <!-- Table for Product Variations (CRUD) -->
        <table class="table table-bordered mt-4">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Storage</th>
                    <th>RAM</th>
                    <th>Quantity</th>
                    <th>Import Price</th>
                    <th>Selling Price</th>
                    <th>Discount</th>
                    <th>Price after Discount</th>
                    <th>Profit</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="variationTable">
                <tr>
                    <td>1</td>
                    <td>512GB</td>
                    <td>16GB</td>
                    <td>10</td>
                    <td>900</td>
                    <td>1000</td>
                    <td>5%</td>
                    <td>950</td>
                    <td>50</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn btn-warning btn-sm" id="editVariationBtn">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteVariation(1)">Delete</button>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>1TB</td>
                    <td>32GB</td>
                    <td>5</td>
                    <td>1300</td>
                    <td>1500</td>
                    <td>0%</td>
                    <td>1500</td>
                    <td>200</td>
                    <td>
                        <div class="action-btns">
                            <button class="btn btn-warning btn-sm" onclick="editVariation(2, '1TB', '32GB', 5, 1500)">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="deleteVariation(2)">Delete</button>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Add Panel -->
<div id="addPanel">
    <span class="close-btn" onclick="closeAddPanel()">×</span>
    <h4>Add Variation</h4>
    <form id="addForm">
        <!-- Storage Field with Listbox -->
        <div class="form-group form-inline">
            <label for="storage">Storage:</label>
            <select class="form-control ml-2" id="storage">
                <option value="256GB">256GB</option>
                <option value="512GB" selected>512GB</option>
                <option value="1TB">1TB</option>
            </select>
        </div>

        <!-- RAM Field with Listbox -->
        <div class="form-group form-inline">
            <label for="ram">RAM:</label>
            <select class="form-control ml-2" id="ram">
                <option value="8GB">8GB</option>
                <option value="16GB" selected>16GB</option>
                <option value="32GB">32GB</option>
            </select>
        </div>

        <!-- Quantity Input -->
        <div class="form-group form-inline">
            <label for="quantity">Quantity:</label>
            <input type="number" class="form-control ml-2" id="quantity" placeholder="Enter quantity" min="1">
        </div>

        <!-- Import Price Input -->
        <div class="form-group form-inline">
            <label for="importPrice">Import Price ($):</label>
            <input type="number" class="form-control ml-2" id="importPrice" placeholder="Enter price" min="0">
        </div>

        <!-- Selling Price Input -->
        <div class="form-group form-inline">
            <label for="sellingPrice">Selling Price ($):</label>
            <input type="number" class="form-control ml-2" id="sellingPrice" placeholder="Enter price" min="0">
        </div>

        <!-- Discount Input -->
        <div class="form-group form-inline">
            <label for="discount">Discount (%):</label>
            <input type="number" class="form-control ml-2" id="discount" placeholder="Enter discount" min="0">
        </div>

        <button type="button" class="btn btn-success" onclick="addVariation()">Add</button>
    </form>
</div>

<!-- Edit Panel -->
<div id="editPanel">
    <span class="close-btn" onclick="closeEditPanel()">×</span>
    <h4>Edit Variation</h4>
    <form id="editForm">
        <!-- Storage Field with Listbox -->
        <div class="form-group form-inline">
            <label for="storage">Storage:</label>
            <select class="form-control ml-2" id="storage">
                <option value="256GB">256GB</option>
                <option value="512GB" selected>512GB</option>
                <option value="1TB">1TB</option>
            </select>
        </div>

        <!-- RAM Field with Listbox -->
        <div class="form-group form-inline">
            <label for="ram">RAM:</label>
            <select class="form-control ml-2" id="ram">
                <option value="8GB">8GB</option>
                <option value="16GB" selected>16GB</option>
                <option value="32GB">32GB</option>
            </select>
        </div>

        <!-- Quantity Input -->
        <div class="form-group form-inline">
            <label for="quantity">Quantity:</label>
            <input type="number" class="form-control ml-2" id="quantity" placeholder="Enter quantity" min="1">
        </div>

        <!-- Import Price Input -->
        <div class="form-group form-inline">
            <label for="importPrice">Import Price ($):</label>
            <input type="number" class="form-control ml-2" id="importPrice" placeholder="Enter price" min="0">
        </div>

        <!-- Selling Price Input -->
        <div class="form-group form-inline">
            <label for="sellingPrice">Selling Price ($):</label>
            <input type="number" class="form-control ml-2" id="sellingPrice" placeholder="Enter price" min="0">
        </div>

        <!-- Discount Input -->
        <div class="form-group form-inline">
            <label for="discount">Discount (%):</label>
            <input type="number" class="form-control ml-2" id="discount" placeholder="Enter discount" min="0">
        </div>
        <button type="button" class="btn btn-primary" onclick="saveChanges()">Save</button>
    </form>
</div>

@{
    var laptops = ViewBag.Laptops ?? new List<dynamic>();
    var phones = ViewBag.Smartphones ?? new List<dynamic>();
}
<script>
    // JavaScript function to update subcategories based on selected category
    function updateSubcategory() {
        // Get selected category value
        var category = document.getElementById("category").value;
        var subcategory = document.getElementById("subcategory");

        // Clear previous options
        subcategory.innerHTML = "";

        // Check category and update the subcategory options accordingly
        if (category === "laptop") {
    @foreach (var laptop in ViewBag.Laptops)
    {
        <text>
                        var option = document.createElement("option");
                        option.value = "@laptop.Id";
                        option.text = "@laptop.Name";
                        subcategory.add(option);
        </text>
    }
                        } else if (category === "phone") {
    @foreach (var phone in ViewBag.Smartphones)
    {
        <text>
                        var option = document.createElement("option");
                        option.value = "@phone.Id";
                        option.text = "@phone.Name";
                        subcategory.add(option);
        </text>
    }
                        }
    }
</script>


<script>
    document.getElementById("addVariationBtn").onclick = function () {
        document.getElementById("addPanel").style.display = "block";
    };

    document.getElementById("editVariationBtn").onclick = function () {
        document.getElementById("editPanel").style.display = "block";
    };

    // Function to close the Add Panel
    function closeAddPanel() {
        document.getElementById("addPanel").style.display = "none";
    }
    function closeEditPanel() {
        document.getElementById("editPanel").style.display = "none";
    }
</script>
